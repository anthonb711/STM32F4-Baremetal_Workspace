#include <stdint.h>
#include <stdio.h>
#include "stm32f411xE.h"
#include "uart.h"
#include "adc.h"
#include "systick.h"
#include "tim.h"

#define GPIOAEN		(1U<<0)
#define	GPIOA_5		(1U<<5)
#define LED			GPIOA_5



uint32_t sensor_value;

int main(void)
{
	/* LED Pin set up */
	RCC->AHB1ENR |= GPIOAEN;	// enable the clock from the AHB1 bus to Port A. Write the enable bit to the Bus register


	uart2_tx_init(); 		// output to display
	pa1_adc_init();			// adc input pins
	start_conversion();		// start the adc conversion
	tim2_1hz_init();		// timer 1 second (1Hz) timer init

	while(1)
	{
		/* wait for UIF*/
		while(!(TIM2->SR & SR_UIF)) {}

		/* clear the UIF because it has been read */
		TIM2->SR &=~ SR_UIF;

		sensor_value = adc_read();
		if((sensor_value > 900) | (sensor_value < 300))
		{
		printf("Sensor_value: %d \n\r", (int)sensor_value);
		GPIOA->ODR ^= LED;

		}
	}
}





