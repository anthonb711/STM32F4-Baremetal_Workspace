#include "stm32f411xE.h"
#include "exti.h"


#define GPIOCEN			(1U<<2)

#define SYSCFGEN		(1U<<14)
#define EXTICR4_EXTI13	(1U<<5)	// PC13 = 0010 [4:7]

/* I interrupt toggle when the user pushbutton is pressed
 *	The push button is on PC13
 *
 *	configure PC13 pin 13 as an input to generate an interrupt when a rising or
 *	falling edge on the button input is detected
 * */


void pc13_exti_init(void)
{
	/* disable global interrupt, THIS IS BEST PRACTICE */
	__disable_irq(); // this is found in the chip specific .h file

	/* enable clock access for GPIOC */
	RCC->AHB1ENR |= GIPOCEN;
	/* enable clock access to SYSCFG module */
	RCC->APB2ENR |= SYSCFGEN;

	/* set direction for Pin 13 */
	GPIOC->MODER &=~(1U<<26);
	GPIOC->MODER &=~(1U<<27);
	/* select Port C for EXTI13 */
	SYSCFG->EXTICR[3] |= EXTICR4_EXTI13;
	/* unmask EXTI13 */
	/* select falling edge trigger */
	/* enable EXTI13 line in NVIC  */
	/* enable global interrupt */
	/*  */
	/*  */
	/*  */

}
